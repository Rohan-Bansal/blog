<!DOCTYPE html>
<html>
<head 4.0.0-rc.2'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>Surprising People with a Dragon - SSH Servers in Golang - Blawg | Rohan Bansal</title>
  
    <meta name="keywords" content="ssh, golang, custom, server, vps, dragon, ascii">
  

  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="Blawg | Rohan Bansal">
  

  <!-- import meta -->
  

  <!-- link -->
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css">

  
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  

  

  

  

  

  <!-- import link -->
  

  
  
    
<link rel="stylesheet" href="/css/style.css">

  
  

<body>
  <header class="l_header auto shadow blur" style='opacity: 0' >
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='/img/rohan.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/custom.xml
                  
                  
                  
                    id="customxml"
                  >
                  <i class='fas fa-rss fa-fw'></i>RSS
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://rbansal.dev
                  
                  
                  
                    id="https:rbansaldev"
                  >
                  <i class='fas fa-globe fa-fw'></i>Main Site
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>Archives
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>About
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/custom.xml
                  
                  
                  
                    id="customxml"
                  >
                  <i class='fas fa-rss fa-fw'></i>RSS
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://rbansal.dev
                  
                  
                  
                    id="https:rbansaldev"
                  >
                  <i class='fas fa-globe fa-fw'></i>Main Site
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>Archives
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>About
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  <div class="l_body">
    <div class="l_cover">

  
  
      <div class='cover-wrapper post focus' style="display: none;">
        
          <div class='cover-bg lazyload placeholder' data-bg="/img/astronaut.jpg"></div>
        
        <div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">Blawg</p>
    
    
      <p class="subtitle">My musings, experiences, and tech talks</p>
    
  </div>
  <div class='bottom'>
    <div class='menu navigation'>
      <div class='list-h'>
        
          
            <a href="/about/"
              
              
              id="about">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c3.svg'><p>About</p>
            </a>
          
            <a href="/links/"
              
              
              id="links">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f516.svg'><p>Links</p>
            </a>
          
            <a href="/subscribe/"
              
              
              id="subscribe">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg'><p>Subscribe</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

        <div class="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
      </div>
  

</div>

    <div class='safearea'>
      <div class='body-wrapper' id="pjax-container">
        
          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->



<div id="pjax-data" style="display: none">
  <div id="pjax-ispage">true</div>
  <div id="pjax-pageTitle">Surprising People with a Dragon - SSH Servers in Golang</div>
  <div id="pjax-enable-cover">true</div>
  <div id="pjax-comment-path"></div>
  <div id="pjax-comment-placeholder"></div>
</div>


<script>
  // 处理封面 此时 jquery 还没加载
  if ("none" == "none") { // 移除封面
    document.getElementsByClassName('cover-wrapper')[0].style.display = "none";
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.add("show");
  } else {
    if ("none" == "half") { // 半屏
      document.getElementsByClassName('cover-wrapper')[0].setAttribute('id', 'half');
      document.getElementsByClassName('scroll-down')[0].style.display = "none";
    } else if ("none" == "full") { // 全屏
      document.getElementsByClassName('cover-wrapper')[0].setAttribute('id', 'full');
      document.getElementsByClassName('scroll-down')[0].style.display = "";
    }
    document.getElementsByClassName('cover-wrapper')[0].style.display = "";
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.remove("show");
  }
</script>


        
        

<div class='l_main'>
  <article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost">
  


  <div class='article-header'>
    
    <div class="article-meta" id="top">
      
      
      
        <h1 class="title">
          <a href="/2021/01/05/Building-a-Custom-SSH-Server-in-Golang-Dragons/">
            Surprising People with a Dragon - SSH Servers in Golang
          </a>
        </h1>
        <div class='new-meta-box'>
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="/" rel="nofollow">
    <img no-lazy src="https://avatars1.githubusercontent.com/u/36248672?s=460&u=aa6e1ef0783d385055d7b3620544b29eb2a6f01b&v=4">
    <p>Rohan Bansal</p>
  </a>
</div>

            
          
            
              

            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>Date : Jan 5, 2021</p>
  </a>
</div>

            
          
            
              

            
          
        </div>
      
    </div>
  </div>


  <div class="article-entry" itemprop="articleBody">
    
    
    <p><img src="/images/dragon_advice.png" class="lazyload" data-srcset="/images/dragon_advice.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Want to make SSH print this out?"></p>
<p><strong>Update 01/5/21</strong></p>
<p>Hey guys! It’s been a while since I last posted something here (almost 3 months). My schedule is a bit erratic, so posts arrive at quite random times. I plan on writing a post every week and setting up the commenting system soon, so stay tuned for that!</p>
<p><strong>Regularly scheduled programming</strong></p>
<p>SSH is cool, and I recently just went down the deep rabbit hole regarding the topic. There are so many cool applications to build with this technology!</p>
<p>Don’t know what I’m talking about? Go enter this into your terminal: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh me.rbansal.dev</span><br></pre></td></tr></table></figure>

<p>Cool right? I’ll be going through the detailed process of building an SSH app like this so you can make your own! </p>
<h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h2><ul>
<li><a href="https://golang.org/" target="_blank" rel="noopener">Go</a> installed, basic knowledge of syntax</li>
<li>A MacOS, Windows, or Linux workstation</li>
<li>A Linux VPS to deploy the finished product (optional)</li>
<li>An IDE to write code with</li>
</ul>
<h2 id="How-Does-It-Work"><a href="#How-Does-It-Work" class="headerlink" title="How Does It Work?"></a>How Does It Work?</h2><p>In my experience building this about a week ago, I had more trouble setting up the deployment environment than actually writing the script. For example, I had to switch out the default port for SSH to free it up for the purposes of this custom server, as well as install the script environment.</p>
<h3 id="SSH-Definitions"><a href="#SSH-Definitions" class="headerlink" title="SSH Definitions"></a>SSH Definitions</h3><ol>
<li>SSH runs over TCP (Transmission Control Protocol). A connection is handled by an SSH server (usually OpenSSH) that can send all the right TCP commands back to the client to secure the connection.</li>
<li>The default SSH port is 22, but it can be changed to anything you like (within bounds).</li>
<li>SSH makes use of an encryption system that requires a key on both the server and the client to authenticate. Most of the time, this is auto-generated.</li>
</ol>
<h3 id="Go-Definitions"><a href="#Go-Definitions" class="headerlink" title="Go Definitions"></a>Go Definitions</h3><ol>
<li>Go is an open-source programming language developed by Google.</li>
<li>It is statically typed and compiled, with syntax extremely similar to C, Java, and Javascript.</li>
</ol>
<h2 id="Building-the-Server"><a href="#Building-the-Server" class="headerlink" title="Building the Server"></a>Building the Server</h2><p>We’re ready to get started! The SSH library we’ll be using to build this script is <a href="https://github.com/gliderlabs/ssh" target="_blank" rel="noopener">this one</a>. We’ll print out an awesome dragon like in the thumbnail!</p>
<h3 id="Writing-the-Go-script"><a href="#Writing-the-Go-script" class="headerlink" title="Writing the Go script"></a>Writing the Go script</h3><p>Let’s begin by creating a new file called <code>server.go</code> in a directory of your choice. At the top of the file, write in the following:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"runtime"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">	<span class="string">"github.com/gliderlabs/ssh"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>If you use an IDE such as Visual Studio Code, there is a chance that the <code>import</code> block will be deleted on save. This is because Go does not allow programs to contain unused imports, and at this point during our code-writing process, we don’t have any code that uses those imports yet.</p>
<p><code>fmt</code>, <code>io</code>, <code>log</code>, and <code>strings</code> are base packages we import to deal with I/O and printing to terminal. <code>runtime</code> is used later to detect if the operating system was running Windows (you’ll see why later). <code>time</code> was used to build a “typewriter” function that emulates a person typing. Lastly, the external package at the bottom is a key libraries we use to build out this SSH program.</p>
<p>Next, we want to print color to the terminal (Note this doesn’t work on Windows, that’s why we need to detect that). Go ahead and add these ASCII codes that indicate color:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Reset = <span class="string">"\033[0m"</span></span><br><span class="line"><span class="keyword">var</span> Red = <span class="string">"\033[31m"</span></span><br><span class="line"><span class="keyword">var</span> Green = <span class="string">"\033[32m"</span></span><br><span class="line"><span class="keyword">var</span> Yellow = <span class="string">"\033[33m"</span></span><br><span class="line"><span class="keyword">var</span> Blue = <span class="string">"\033[34m"</span></span><br><span class="line"><span class="keyword">var</span> Purple = <span class="string">"\033[35m"</span></span><br><span class="line"><span class="keyword">var</span> Cyan = <span class="string">"\033[36m"</span></span><br><span class="line"><span class="keyword">var</span> Gray = <span class="string">"\033[37m"</span></span><br><span class="line"><span class="keyword">var</span> White = <span class="string">"\033[97m"</span></span><br></pre></td></tr></table></figure>

<p>The first variable, <code>Reset</code>, resets the color after we use it. Let’s create a function now that utilizes these colors to typewrite something to the terminal! Go ahead and add this at the bottom of the file:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typewrite</span><span class="params">(w io.Writer, content <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	chars := strings.Split(content, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, c := <span class="keyword">range</span> chars &#123;</span><br><span class="line">		fmt.Fprint(w, c)</span><br><span class="line">		time.Sleep(<span class="number">30</span> * time.Millisecond)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s go over this part by part.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typewrite</span><span class="params">(w io.Writer, content <span class="keyword">string</span>)</span></span> &#123;</span><br></pre></td></tr></table></figure>

<p>We first declare a function that takes two inputs: an <code>io.Writer</code> object, and a <code>string</code> object. The first parameter will be the “terminal” we instantiate later. The second is the string we want to type!</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chars := strings.Split(content, <span class="string">""</span>)</span><br></pre></td></tr></table></figure>

<p>Next, we create a list of characters by splitting the string up into letters.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> chars &#123;</span><br><span class="line">    fmt.Fprint(w, c)</span><br><span class="line">    time.Sleep(<span class="number">30</span> * time.Millisecond)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Last, we iterate over the list of characters and print out the letter we are currently on, then put the thread to “sleep” for a few milliseconds. This results in a really cool typewriter effect!</p>
<p><img src="/images/typewriting.gif" class="lazyload" data-srcset="/images/typewriting.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="typewriting!"></p>
<p>Now, in that GIF, you can see that I colored my name! Let’s go ahead and do that with our typewriting function. To keep things modular, let’s create a new function called <code>colorType</code> that uses <code>typewrite</code> but with color!</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">colorType</span><span class="params">(w io.Writer, text <span class="keyword">string</span>, color <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	typewrite(w, color+text+Reset)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This function basically takes the same parameters as <code>typewrite</code>, but with an extra one called <code>color</code>. We just set the color of the text inputted and continue to pass it to our typewrite function!</p>
<p>Last but not least, we’ll build our final helper function that prints empty lines to space out text.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printEnd</span><span class="params">(w io.Writer, ends <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; ends; i++ &#123;</span><br><span class="line">		fmt.Fprint(w, <span class="string">"\n"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We iterate <strong>n</strong> amount of times, printing spaces (<code>\n</code>) as we go.</p>
<p>Alright, it’s time to write the main function! Let’s add the following code at the bottom of the file:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> runtime.GOOS == <span class="string">"windows"</span> &#123;</span><br><span class="line">		Reset = <span class="string">""</span></span><br><span class="line">		Red = <span class="string">""</span></span><br><span class="line">		Green = <span class="string">""</span></span><br><span class="line">		Yellow = <span class="string">""</span></span><br><span class="line">		Blue = <span class="string">""</span></span><br><span class="line">		Purple = <span class="string">""</span></span><br><span class="line">		Cyan = <span class="string">""</span></span><br><span class="line">		Gray = <span class="string">""</span></span><br><span class="line">		White = <span class="string">""</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>What does this <code>if</code> statement do? Well, since Windows cannot interpret ASCII color codes, we have to remove them 😭. </p>
<p>Now for the fun part! To intercept an SSH connection and do cool things with it, we need to add an SSH Handler and listen for connections. Let’s do so like this (put it inside the <code>main</code> function, under the <code>if</code> statement):</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh.Handle(<span class="function"><span class="keyword">func</span><span class="params">(s ssh.Session)</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line">           </span><br><span class="line">log.Println(<span class="string">"Started SSH server on port 2222"</span>)</span><br><span class="line">log.Println(<span class="string">"System: "</span> + runtime.GOOS)</span><br><span class="line">log.Fatal(ssh.ListenAndServe(<span class="string">":2222"</span>, <span class="literal">nil</span>))</span><br></pre></td></tr></table></figure>

<p>The <code>ssh.Handle()</code> function is where we’re going to be printing our dragon. The other three lines log some essential information and start the server on a specific port, which is 2222.</p>
<p>Before we test this out, let’s print something to the terminal! To do this, we need to create an object that represents our terminal instance. Inside the <code>ssh.Handle()</code> function, add the following:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh.Handle(<span class="function"><span class="keyword">func</span><span class="params">(s ssh.Session)</span></span> &#123;</span><br><span class="line">    <span class="comment">// add the next 3 lines</span></span><br><span class="line">    term := terminal.NewTerminal(s, <span class="string">""</span>)</span><br><span class="line">	colorType(term, <span class="string">"hello world"</span>, Purple)</span><br><span class="line">	printEnd(term, <span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>The first line instantiates a terminal, with the prompt being empty. In this tutorial, you’ll never see this prompt, but if you decide to expand on this feel free to change the text to *”Press [Enter] To Continue…”* or something!</p>
<p>Now go ahead and save the file so we can test it out! If you’re on Mac/Linux, enter the following into your terminal in the project directory:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> run server.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>

<p>This code runs the server. You should see the log output, which details that the server started and the operating system. Next, enter this command (Windows will have to use PuTTY):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 2222 &lt;hostname&gt;@127.0.0.1</span><br></pre></td></tr></table></figure>

<p>This allows you to SSH into your own machine to test out the program! Replace <code>&lt;hostname&gt;</code> with the hostname of your computer.</p>
<p><img src="/images/ssh-output.png" class="lazyload" data-srcset="/images/ssh-output.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Do you see this?"></p>
<p>If you see output like above, you did it! SSH is now set up! As a bonus, let’s replace that “hello” with a dragon:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ssh.Handle(<span class="function"><span class="keyword">func</span><span class="params">(s ssh.Session)</span></span> &#123;</span><br><span class="line">		term := terminal.NewTerminal(s, <span class="string">""</span>)</span><br><span class="line">		colorType(term, <span class="string">`___</span></span><br><span class="line"><span class="string">						/ \  //\</span></span><br><span class="line"><span class="string">		|\___/|      /   \//  \\</span></span><br><span class="line"><span class="string">		/0  0  \__  /    //  | \ \    </span></span><br><span class="line"><span class="string">		/     /  \/_/    //   |  \  \  </span></span><br><span class="line"><span class="string">		@_^_@'/   \/_   //    |   \   \ </span></span><br><span class="line"><span class="string">		//_^_/     \/_ //     |    \    \</span></span><br><span class="line"><span class="string">	( //) |        \///      |     \     \</span></span><br><span class="line"><span class="string">	( / /) _|_ /   )  //       |      \     _\</span></span><br><span class="line"><span class="string">( // /) '/,_ _ _/  ( ; -.    |    _ _\.-~        .-~~~^-.</span></span><br><span class="line"><span class="string">(( / / )) ,-&#123;        _       -.|.-~-.           .~          .</span></span><br><span class="line"><span class="string">(( // / ))  '/\      /                 ~-. _ .-~      .-~^-.  \</span></span><br><span class="line"><span class="string">(( /// ))       .   &#123;            &#125;                   /      \  \</span></span><br><span class="line"><span class="string">(( / ))     .----~-.\        \-'                 .~         \   . \^-.</span></span><br><span class="line"><span class="string">			///.----..&gt;        \             _ -~              .  ^-   ^-_</span></span><br><span class="line"><span class="string">			///-._ _ _ _ _ _ _&#125;^ - - - - ~                     ~-- ,.-~</span></span><br><span class="line"><span class="string">																/.-~`</span>, Purple)</span><br><span class="line">		printEnd(term, <span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Remember to copy and paste this exactly as it is, or the ASCII art will mess up a bit. Feel free to replace the dragon with whatever you want!</p>
<h2 id="Extra-Deployment-to-a-VPS"><a href="#Extra-Deployment-to-a-VPS" class="headerlink" title="Extra - Deployment to a VPS"></a>Extra - Deployment to a VPS</h2><p>I won’t go too in-depth about deployment here, as much of it can be found online. I will, however, outline the steps here to put this online!</p>
<ol>
<li>Find a VPS (Virtual Private Server)</li>
<li>SSH into the VPS using the default port (usually 22)</li>
<li>Modify the default port in <code>/etc/ssh/sshd_config</code> and make it another arbitrary one (e.g. 4242)</li>
<li>Use <code>rsync</code> , <code>scp</code>, or <code>ftp</code> to copy your Go script into the VPS. Install Go as well!</li>
<li>Using <code>nano</code>, change the default port at the end of the <code>main()</code> function in the script to <strong>22</strong></li>
<li>Set up a domain name that points to your VPS so anyone can SSH</li>
<li>Run the Go script with <code>go run server.go</code></li>
<li>Test it out! On a different computer try to ssh into your VPS’s IP address</li>
</ol>
<h2 id="Final-Notes"><a href="#Final-Notes" class="headerlink" title="Final Notes"></a>Final Notes</h2><p>My personal SSH server code is not up on GitHub yet; you’ll have to refer to this article for the time being. I was heavily inspired by an SSH game I came across by <a href="https://github.com/zachlatta" target="_blank" rel="noopener">Zach Latta</a> called SSHTron. Go SSH into <code>sshtron.zachlatta.com</code> to check it out!</p>
<p>Again, I know I haven’t posted in a while, but I made a new year’s resolution to start writing a bit here every weekend. That way, I can look back on it in the future and remember!</p>
<p>Anyway, I hope you all had fun building this project, as I think there aren’t many tutorials out there yet on the subject. Feel free to contact me via the methods on my <a href="https://rbansal.dev" target="_blank" rel="noopener">website</a> if you have any questions or want to share a cool creation!</p>

    
      
      <div class='footer'>
        
        
        
          <div class='copyright'>
            <blockquote>
              
                
                  
                
              
                
                  <p><a href=http://blog.rbansal.dev/2021/01/05/Building-a-Custom-SSH-Server-in-Golang-Dragons/>http://blog.rbansal.dev/2021/01/05/Building-a-Custom-SSH-Server-in-Golang-Dragons/</a></p>
                
              
            </blockquote>
          </div>
        
        
      </div>
    
  </div>
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2021-01-05T19:23:19-08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>Updated : Jan 5, 2021</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/ssh-golang-custom-server-vps-dragon-ascii/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>ssh, golang, custom, server, vps, dragon, ascii</p></a></div>


        
      
        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
      
        <a class='next' href='/2020/10/27/Workshop-Meme-Songs-With-Arduino/'>
          <p class='title'>Workshop - Meme Songs With Arduino<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>Meme Songs with Arduino
OverviewMeme songs are everywhere! I bet you (the reader) have been rickr...</p>
        </a>
      
    </div>
  
</article>



</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper shadow desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>Contents</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Requirements"><span class="toc-text">Requirements</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-Does-It-Work"><span class="toc-text">How Does It Work?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH-Definitions"><span class="toc-text">SSH Definitions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Go-Definitions"><span class="toc-text">Go Definitions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Building-the-Server"><span class="toc-text">Building the Server</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Writing-the-Go-script"><span class="toc-text">Writing the Go script</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extra-Deployment-to-a-VPS"><span class="toc-text">Extra - Deployment to a VPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Final-Notes"><span class="toc-text">Final Notes</span></a></li></ol>
    </div>
  </section>


  


</aside>



      </div>
      
  
  <footer class="footer clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social  flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
                
                  <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/020-rss.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/020-rss.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/>
                
              </a>
            
          
            
          
            
              <a href="https://github.com/rohan-bansal"
                class="social  flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
                
                  <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/029-github.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/029-github.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/>
                
              </a>
            
          
            
              <a href="https://twitter.com/rbansal22"
                class="social  flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
                
                  <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/018-twitter.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/018-twitter.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/>
                
              </a>
            
          
            
              <a href="/"
                class="social  flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
                
                  <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/045-telegram.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/045-telegram.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/>
                
              </a>
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
        <div><p><i>Banner drawn by Tithi Luadthong</i></p></div>
        <div><p><strong>Based on Volantis</strong></p></div>
      
    
      
        
      
    
      
         
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © 2019-2020 Rohan Bansal</a></p>

        </div>
      
    
  </footer>


      <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
    </div>
  </div>
  <div>
    
    <!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  function pjax_fancybox() {
    $(".md").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      // 背景层
      var bgDiv = document.createElement("div");
      $(bgDiv).addClass("bg");
      if ($(this).attr('bg')) {
        $(bgDiv).css('background', $(this).attr('bg'));
      }
      $(this).wrap(bgDiv); // 背景层
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".article-entry").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  $(function () {
    pjax_fancybox();
  });
</script>


<!-- internal -->



<!-- optional -->

  <script>
  
  var SEARCH_SERVICE = "hexo" || "hexo";
  var ROOT = "/" || "/";
  if (!ROOT.endsWith('/')) ROOT += '/';
</script>




  <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  
  
    <script>
      window.FPConfig = {
        delay: 0,
        ignoreKeywords: [],
        maxRPS: 5,
        hoverDelay: 25
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script>
  




  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
		if($(".highlight .code pre").length+$(".article pre code").length==0)return;
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
</script>








  
  
<script src="/js/valine.js"></script>


<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link'.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick', 'mail', 'link'];
  var requiredFields = 'nick,mail'.split(',').filter(function (item) {
    return REQUIRED_FIELDS.indexOf(item) > -1
  });

  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }

  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }

  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;

    let pagePlaceholder = $.trim($('#pjax-comment-placeholder').text()) || "Write something!";

    let path = $.trim($('#pjax-comment-path').text());
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }

    var valine = new Valine();
    valine.init({
      el: '#valine_container',
      meta: meta,
      placeholder: pagePlaceholder,
      path: path,
      appId: "",
      appKey: "",
      pageSize: '10',
      avatar: 'robohash',
      lang: 'en',
      visitor: 'true',
      highlight: 'true',
      mathJax: 'false',
      enableQQ: 'true',
      requiredFields: requiredFields,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps
    })
  }

  $(function () {
    pjax_valine();
  });
</script>







  
<script src="/js/app.js"></script>




  
    
<script src="/js/search.js"></script>

  











<!-- more -->


    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>

<!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <div id="loading-bar-wrapper"><script>NProgress.configure({parent:"#loading-bar-wrapper",trickleSpeed: 100})</script></div>
    <script>
      window.ShowLoading = function() {
        NProgress.start();
      };
      window.HideLoading = function() {
        NProgress.done();
      }
    </script>
  
</div>

<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      $.fancybox.close();    // 关闭弹窗
      $('.l_header .switcher .s-search').removeClass('active'); // 关闭移动端激活的搜索框
      $('.l_header').removeClass('z_search-open'); // 关闭移动端激活的搜索框
      $('.wrapper').removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      $('.s-top').unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
      window.ShowLoading();
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
      // 

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
        pjax_fancybox();
        
        
        
        
          pjax_initCopyCode();
        
        
          pjax_valine();
        
        
        
        
        
      } catch (e) {
        console.log(e);
      }
      window.HideLoading();
    });

    document.addEventListener('pjax:error', function (e) {
      window.HideLoading();
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script async>

    function post(path, params, method='post') {

        // The rest of this code assumes you are not using a library.
        // It can be made less wordy if you use one.
        const form = document.createElement('form');
        form.method = method;
        form.action = path;

        for (const key in params) {
          if (params.hasOwnProperty(key)) {
            const hiddenField = document.createElement('input');
            hiddenField.type = 'hidden';
            hiddenField.name = key;
            hiddenField.value = params[key];

            form.appendChild(hiddenField);
          }
        }

        document.body.appendChild(form);
        form.submit();
    }

    var done = false;

    async function fireSwal(done) {
        if(!done) {
        const { value: email } = await Swal.fire({
              title: 'Subscribe To My Newsletter!',
              input: 'email',
              inputLabel: 'If you would like to get news of recent articles straight to your inbox!',
              inputPlaceholder: 'email'
            })

            if (email) {
              Swal.fire(`Successfully Subscribed!`)
              post('https://rohanbansal.us10.list-manage.com/subscribe/post', {
                "u":"eb650c2d4e1adedd983e74b4e",
                "id":"3c40ef0756",
                "MERGE0":`${email}`,
              })
              //    window.location.href="/";
            }
        done = true;
      }
    }

    // setTimeout(() => fireSwal(done), 8000);



  </script>
</body>

</html>
